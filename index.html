<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TasteLink | Welcome</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div id="welcome-screen">
  <h1>‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡∏ú‡∏à‡∏ç‡∏†‡∏±‡∏¢‡∏™‡∏π‡πà TasteLink!</h1>
  <h2>‡∏Ñ‡∏∏‡∏ì‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏≠‡∏≠‡∏Å‡∏ú‡∏à‡∏ç‡∏†‡∏±‡∏¢‡πÉ‡∏ô YumYum Network ‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á? üå≥üçî</h2>
  <button onclick="enterLogin()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ú‡∏à‡∏ç‡∏†‡∏±‡∏¢!</button>
</div>

<div id="login-screen" style="display:none;">
  <h2>‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h2>
  <input type="text" id="player-name" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô..." maxlength="12">
  
  <h3>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏ß‡∏≤‡∏ï‡∏≤‡∏£‡πå (Emoji)</h3>
  <div id="avatar-preview" style="font-size:64px; text-align:center;">üßô‚Äç‚ôÇÔ∏è</div>
  <input type="text" id="avatar-emoji" maxlength="2" placeholder="‡πÉ‡∏™‡πà‡∏≠‡∏¥‡πÇ‡∏°‡∏à‡∏¥ ‡πÄ‡∏ä‡πà‡∏ô üßô‚Äç‚ôÇÔ∏è" oninput="updateAvatarPreview()">

  <h3>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</h3>
  <input type="color" id="avatar-bg" value="#ffd700" onchange="updateAvatarPreview()">

  <button onclick="startAdventure()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà YumYum Park!</button>
</div>

<script type="module">
import { db } from './firebase.js';
import { doc, setDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

function enterLogin() {
  document.getElementById('welcome-screen').style.display = 'none';
  document.getElementById('login-screen').style.display = 'block';
}

function updateAvatarPreview() {
  const emoji = document.getElementById('avatar-emoji').value || 'üßô‚Äç‚ôÇÔ∏è';
  const bg = document.getElementById('avatar-bg').value;
  const preview = document.getElementById('avatar-preview');
  preview.textContent = emoji;
  preview.style.backgroundColor = bg;
  preview.style.borderRadius = '50%';
  preview.style.width = '100px';
  preview.style.height = '100px';
  preview.style.lineHeight = '100px';
}

async function startAdventure() {
  const name = document.getElementById('player-name').value;
  const emoji = document.getElementById('avatar-emoji').value || 'üßô‚Äç‚ôÇÔ∏è';
  const bg = document.getElementById('avatar-bg').value;

  if (!name) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô'); return; }

  // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Firestore
  await setDoc(doc(db, 'players', name), {
    name: name,
    emoji: emoji,
    bg: bg,
    points: 0,
    votes: {},
    reviews: []
  });

  // ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏ß‡∏ô
  window.location.href = 'park.html?player=' + encodeURIComponent(name);
}
</script>

</body>
</html>
